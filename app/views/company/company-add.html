{% extends "../layouts/ukti-search-header.html" %}
{% import "macros/forms.html" as forms %}

{% block main %}

  <a class="back-link" href='/'>Back to home</a>

  {{ forms.errorPanel(errors) }}

  <h1 class="heading-xlarge">
    Add new company
  </h1>

  <form method="post">

    <div class="form-group{% if errors.name %} error{% endif %}" id="name-wrapper">
      <label class="form-label" for="name">
        Company trading name
        {% if error.name %}<span class="error-message">{{ error }}</span>{% endif %}
      </label>

      <input
        id="name"
        class="form-control autocomplete company-autocomplete"
        name="name"
        value="{{ formData.name }}"
        autocomplete="name"
        data-options-url="/suggest?term="
      />

      <div class="indented-info hidden">
        <h3 class="heading-small indented-info__heading">Did you mean this company?</h3>
        <a class="indented-info__link" href="#"></a>
        <p class="indented-info__description"></p>
      </div>

    </div>


    {% call forms.yesNoHidden('uk_based',
      label="Is the business based in the UK?",
      radioValue=formData.uk_based,
      error=errors.uk_based) -%}
        <p>
          You can add any type of company except UK based private and public limited
          companies. These companies are already on data hub as it uses companies
          house data. Please search for these companies first on data hub to add or
          edit their details.
        </p>
    {%- endcall %}

    {{ forms.dropdown('business_type',
      label="Type of business",
      emptyLabel="Select a value",
      value=formData.business_type,
      options=TYPES_OF_BUSINESS,
      error=errors.business_type)
    }}

    {{ forms.dropdown('sector',
      label="Sector",
      emptyLabel="Select sector to add",
      value=formData.sector,
      options=SECTOR_OPTIONS,
      error=errors.sector)
    }}

    {{ forms.address('address',
      label="Company address",
        addressValue=formData.address,
        optionalNonUk='yes',
        optional='no',
        error=errors.address)
    }}

    {{ forms.dropdown('uk_region',
      label="Region",
      emptyLabel="Select a region",
      value=formData.uk_region,
      options=REGION_OPTIONS,
      error=errors.uk_region)
    }}

    <hr/>

    {{ forms.textbox('website', label="Website (optional)", value=formData.website, error=errors.website) }}

    {{ forms.textarea('description',
      label="Business description (optional)",
      value=formData.description,
      error=errors.description)
    }}

    {{ forms.dropdown('employee_range',
      label="Number of employees (optional)",
      emptyLabel="Select a value",
      value=formData.employee_range,
      options=EMPLOYEE_OPTIONS,
      error=errors.employee_range)
    }}

    {{ forms.dropdown('turnover_range',
      label="Annual turnover (optional)",
      emptyLabel="Select a value",
      value=formData.turnover_range,
      options=TURNOVER_OPTIONS,
      error=errors.turnover_range)
    }}

    {% if formData.account_manager and formData.account_manager.length > 0 or errors.account_manager %}
      {% set hasManager = 'Yes' %}
    {% else %}
      {% set hasManager = 'No' %}
    {% endif %}
    {% call forms.yesNoHidden('hasAccountManager', label="Is there an agreed DIT account manager for this company?", radioValue=hasManager, error=errors.accountManager) -%}
      {{ forms.autocomplete('accountManager',
        label="Account manager",
        value=formData.account_manager,
        options=ADVISOR_OPTIONS,
        error=errors.account_manager
      ) }}
    {%- endcall %}


    {% if formData.currently_exporting_to and formData.currently_exporting_to.length > 0 or errors.currently_exporting_to %}
      {% set hasExportingMarkets = 'Yes' %}
    {% else %}
      {% set hasExportingMarkets = 'No' %}
    {% endif %}
    {% call forms.yesNoHidden('hasExportingMarkets', label="Is this company curently exporting to a market?", radioValue=hasExportingMarkets, error=errors.currently_exporting_to) -%}
      {{ forms.addAnotherAutocomplete('exportingMarkets',
        label="Export market",
        addLabel="country",
        values=formData.currently_exporting_to,
        options=COUNTRYS,
        error=errors.currently_exporting_to
      ) }}
    {%- endcall %}

    {{ forms.addAnotherAutocomplete('countries_of_interest',
    label="Future countries of interest (optional)",
    addLabel="country",
    values=formData.countries_of_interest,
    options=COUNTRYS,
    error=errors.countries_of_interest
    ) }}

    {{ forms.addAnotherAutocomplete('connections',
    label="Company connections (optional)",
    addLabel="company connection",
    values=formData.connections,
    options_url="/api/suggest?term=",
    error=errors.connections
    ) }}

    {{ forms.save(backUrl="#") }}

  </form>
  <script src="{{ asset_path }}javascripts/addcompany.bundle.js"></script>
{% endblock %}
